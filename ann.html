<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Announcements</title>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f4f4f4;
        }
        h1 {
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: none;
        }
        button {
            padding: 10px 20px;
            background: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .announcement {
            margin-top: 20px;
            padding: 10px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .pinned {
            background-color: #ffd700; /* Gold color for pinned announcements */
            border: 1px solid #e5c100;
        }
        .edit-btn, .pin-btn, .delete-btn {
            background-color: #28a745;
            color: white;
            padding: 5px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 5px;
        }
        .delete-btn {
            background-color: #dc3545; /* Red color for delete */
        }
        .edit-btn:hover, .pin-btn:hover, .delete-btn:hover {
            background-color: #218838;
        }
        .time {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
            text-align: right;
        }
        /* Go back button styling */
        .go-back-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .go-back-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <h1>Live Announcements</h1>
    
    <!-- Go Back button -->
    <button class="go-back-btn" onclick="goBack()">Go Back</button>
    
    <div class="container">
        <textarea id="announcementInput" placeholder="Write your announcement..."></textarea>
        <button id="postAnnouncement">Post Announcement</button>
        <div id="announcements"></div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB_UjSLiTFca7sEs6Xjo3KJt3gv7irm4yM",
            authDomain: "last-try-e2368.firebaseapp.com",
            databaseURL: "https://last-try-e2368-default-rtdb.firebaseio.com",
            projectId: "last-try-e2368",
            storageBucket: "last-try-e2368.appspot.com",
            messagingSenderId: "96302628355",
            appId: "1:96302628355:web:a87f636cec98c89d2f9836"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // HTML elements
        const announcementInput = document.getElementById("announcementInput");
        const postAnnouncement = document.getElementById("postAnnouncement");
        const announcementsDiv = document.getElementById("announcements");

        // Post a new announcement
        postAnnouncement.addEventListener("click", () => {
            const announcement = announcementInput.value.trim();
            if (announcement) {
                const timestamp = Date.now();
                set(ref(db, "announcements/" + timestamp), {
                    message: announcement,
                    time: new Date().toLocaleString(),
                    pinned: false // Default to not pinned
                })
                .then(() => {
                    alert("Announcement posted!");
                })
                .catch((error) => {
                    console.error("Error adding announcement:", error);
                });
                announcementInput.value = ""; // Clear input
            } else {
                alert("Please enter an announcement.");
            }
        });

        // Listen for new announcements in real-time
        onValue(ref(db, "announcements"), (snapshot) => {
            announcementsDiv.innerHTML = "";
            const data = snapshot.val();
            if (data) {
                const keys = Object.keys(data).sort((a, b) => b - a);
                keys.forEach((key) => {
                    const announcement = data[key];
                    const div = document.createElement("div");
                    div.className = "announcement";
                    const formattedTime = new Date(announcement.time).toLocaleString();

                    // Add special class if pinned
                    if (announcement.pinned) {
                        div.classList.add("pinned");
                    }

                    div.innerHTML = `
                        <strong>${announcement.message}</strong>
                        <div class="time">${formattedTime}</div>
                        <button class="edit-btn" onclick="editAnnouncement('${key}', '${announcement.message}')">Edit</button>
                        <button class="pin-btn" onclick="pinAnnouncement('${key}', ${announcement.pinned})">
                            ${announcement.pinned ? 'Unpin' : 'Pin'}
                        </button>
                        <button class="delete-btn" onclick="deleteAnnouncement('${key}')">Delete</button>
                    `;
                    announcementsDiv.appendChild(div);
                });
            } else {
                announcementsDiv.innerHTML = "<p>No announcements yet.</p>";
            }
        });

        // Edit announcement
        window.editAnnouncement = function(key, oldMessage) {
            const newMessage = prompt("Edit announcement:", oldMessage);
            if (newMessage !== null && newMessage !== oldMessage) {
                update(ref(db, "announcements/" + key), {
                    message: newMessage,
                    time: new Date().toLocaleString() // Update timestamp
                })
                .then(() => {
                    alert("Announcement updated!");
                })
                .catch((error) => {
                    console.error("Error updating announcement:", error);
                });
            }
        };

        // Pin or unpin announcement
        window.pinAnnouncement = function(key, isPinned) {
            update(ref(db, "announcements/" + key), {
                pinned: !isPinned
            });
        };

        // Delete announcement
        window.deleteAnnouncement = function(key) {
            if (confirm("Are you sure you want to delete this announcement?")) {
                remove(ref(db, "announcements/" + key))
                    .then(() => {
                        alert("Announcement deleted!");
                    })
                    .catch((error) => {
                        console.error("Error deleting announcement:", error);
                    });
            }
        };

        // Go back to main.html
        function goBack() {
            window.location.assign("main.html");
        }
    </script>
</body>
</html>
